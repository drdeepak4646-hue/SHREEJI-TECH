<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shree Ji Tech</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Segoe UI;background:#0f2027;color:white;text-align:center}
.box{background:#1e293b;padding:20px;border-radius:10px;width:300px;margin:20px auto}
input{width:100%;padding:10px;margin:5px 0;border:none;border-radius:5px}
button{padding:10px;width:100%;margin:5px 0;background:#ff4d6d;border:none;color:white;border-radius:5px}
</style>
</head>
<body>

<h2>Login System</h2>

<div class="box" id="loginBox">

<input id="mobile" value="+91" />

<div id="recaptcha-container"></div>

<button onclick="startLogin()">Continue</button>

<div id="passwordSection" style="display:none">
<input type="password" id="password" placeholder="Enter Password">
<button onclick="passwordLogin()">Login</button>
<button onclick="forgotPassword()">Forgot Password</button>
</div>

<div id="otpSection" style="display:none">
<input id="otp" placeholder="Enter OTP">
<button onclick="verifyOTP()">Verify OTP</button>
</div>

<div id="setPasswordSection" style="display:none">
<input type="password" id="newPassword" placeholder="Set Password">
<button onclick="savePassword()">Save Password</button>
</div>

</div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBuCywyMgEw_j9yeHD-E4KwRWZGreWagTc",
authDomain:"shree-4c33e.firebaseapp.com",
projectId:"shree-4c33e"
});

const db=firebase.firestore();
let currentMobile=null;
let confirmationResult=null;

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
'recaptcha-container',
{size:'normal'}
);

function startLogin(){
let mobile=document.getElementById("mobile").value;

if(!mobile.startsWith("+91")){
alert("Mobile must start with +91");
return;
}

currentMobile=mobile;

db.collection("users").doc(mobile).get().then(doc=>{
if(doc.exists){
document.getElementById("passwordSection").style.display="block";
}else{
sendOTP();
}
});
}

function sendOTP(){
firebase.auth().signInWithPhoneNumber(currentMobile,window.recaptchaVerifier)
.then(result=>{
confirmationResult=result;
document.getElementById("otpSection").style.display="block";
})
.catch(e=>alert(e.message));
}

function verifyOTP(){
confirmationResult.confirm(document.getElementById("otp").value)
.then(()=>{
db.collection("users").doc(currentMobile).get().then(doc=>{
if(doc.exists){
document.getElementById("setPasswordSection").style.display="none";
alert("Verified. Please login with password.");
}else{
document.getElementById("setPasswordSection").style.display="block";
}
});
});
}

function savePassword(){
let pass=document.getElementById("newPassword").value;

db.collection("users").doc(currentMobile).set({
mobile:currentMobile,
password:pass
});

alert("Password Saved. Login Again.");
location.reload();
}

function passwordLogin(){
let pass=document.getElementById("password").value;

db.collection("users").doc(currentMobile).get().then(doc=>{
if(doc.exists && doc.data().password===pass){
alert("Login Successful");
localStorage.setItem("user",currentMobile);
location.reload();
}else{
alert("Wrong Password");
}
});
}

function forgotPassword(){
sendOTP();
document.getElementById("setPasswordSection").style.display="block";
}
</script>

</body>
</html>
