<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shree Ji Tech | Enterprise Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --dark: #002d36; --red: #e63946; --gold: #ffd700; --green: #25D366; --bg: #87CEEB; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); padding-bottom: 70px; }

        header { background: var(--dark); padding: 15px; color: white; border-bottom: 4px solid var(--red); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .admin-label { background: var(--gold); color: black; font-size: 10px; padding: 2px 5px; border-radius: 3px; font-weight: bold; margin-left: 5px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; padding: 10px; border-radius: 12px; border: 2px solid var(--red); text-align: center; position: relative; }
        .card img { height: 80px; width: 100%; object-fit: contain; }
        .price { color: var(--dark); font-weight: 900; font-size: 18px; margin: 5px 0; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; overflow-y: auto; }
        .box { background: white; padding: 20px; width: 92%; max-width: 450px; border-radius: 20px; border: 4px solid var(--red); position: relative; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 10px; }
        .btn { background: var(--red); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--dark); display: flex; justify-content: space-around; padding: 12px; border-top: 3px solid var(--red); }
        .nav-item { color: white; text-align: center; font-size: 11px; cursor: pointer; }
        
        .admin-section { display: none; margin-top: 15px; border-top: 2px dashed #ccc; padding-top: 10px; }
        .order-card { background: #f4f4f4; padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 12px; border-left: 4px solid var(--green); }
        #recaptcha-container { display: none; }
    </style>
</head>
<body>

    <div id="recaptcha-container"></div>

    <header>
        <div>
            <h2 style="font-size: 18px;">SHREE JI TECH <span id="adminBadge" class="admin-label" style="display:none;">ADMIN</span></h2>
            <p id="welcomeMsg" style="font-size: 10px; color: #ccc;">Welcome Guest</p>
        </div>
        <button id="addBtn" class="btn" style="width:auto; padding:5px 10px; display:none;" onclick="showModal('adminPanel')">‚ûï ADD</button>
    </header>

    <div class="grid" id="productGrid"></div>

    <div id="loginModal" class="modal"><div class="box">
        <h3 style="text-align:center;">Secure Login</h3>
        <div id="step1">
            <input type="number" id="phone" placeholder="Enter 10 Digit Phone">
            <button class="btn" onclick="sendOTP()">Send OTP</button>
        </div>
        <div id="step2" style="display:none;">
            <input type="number" id="otp" placeholder="Enter 6 Digit OTP">
            <button class="btn" onclick="verifyOTP()">Verify Login</button>
        </div>
    </div></div>

    <div id="adminPanel" class="modal"><div class="box">
        <h3>Admin Controls</h3>
        <div class="admin-section" style="display:block;">
            <p><b>Add New Product:</b></p>
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price (‚Çπ)">
            <input type="text" id="pImg" placeholder="Image URL">
            <button class="btn" style="background:var(--dark);" onclick="saveProduct()">Upload Product</button>
        </div>
        <hr style="margin:15px 0;">
        <p><b>Recent Orders:</b></p>
        <div id="orderList" style="max-height: 200px; overflow-y: auto; margin-top:10px;"></div>
        <button class="btn" style="background:#444; margin-top:10px;" onclick="closeModal('adminPanel')">Close</button>
    </div></div>

    <div style="background:#111; color:white; padding:20px; text-align:center; font-size:12px;">
        <p><b>Shree Radhe Communication</b></p>
        <p>Adarsh Nagar, Bichhiya, Gorakhpur</p>
        <a href="https://wa.me/917052055713" style="color:var(--green); text-decoration:none;">üí¨ WhatsApp Support</a>
    </div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="location.reload()">üè†<br>Home</div>
        <div class="nav-item" onclick="showModal('loginModal')">üë§<br>Account</div>
        <div id="adminTab" class="nav-item" style="display:none;" onclick="showModal('adminPanel')">üõ†<br>Orders</div>
    </div>

    <script>
        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBuCywyMgEw_j9yeHD-E4KwRWZGreWagTc",
            authDomain: "shree-4c33e.firebaseapp.com",
            projectId: "shree-4c33e",
            storageBucket: "shree-4c33e.firebasestorage.app",
            messagingSenderId: "759128544690",
            appId: "1:759128544690:web:3f57e7ed9117a1acdd80ab"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const MY_PHONE = "+917052055713"; 

        // AUTH
        function sendOTP() {
            const num = "+91" + document.getElementById('phone').value;
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {size: 'invisible'});
            auth.signInWithPhoneNumber(num, window.recaptchaVerifier).then(res => {
                window.confirmationResult = res;
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
            }).catch(e => alert(e.message));
        }

        function verifyOTP() {
            const code = document.getElementById('otp').value;
            confirmationResult.confirm(code).then(res => {
                localStorage.setItem('userPhone', res.user.phoneNumber);
                location.reload();
            }).catch(() => alert("Wrong OTP"));
        }

        // DATABASE LOGIC
        function saveProduct() {
            const data = {
                name: document.getElementById('pName').value,
                price: document.getElementById('pPrice').value,
                img: document.getElementById('pImg').value,
                time: Date.now()
            };
            db.collection("products").add(data).then(() => {
                alert("Product Added!");
                location.reload();
            });
        }

        function placeOrder(name, price) {
            const user = localStorage.getItem('userPhone');
            if(!user) return showModal('loginModal');
            db.collection("orders").add({
                user: user,
                item: name,
                price: price,
                status: "Pending",
                date: new Date().toLocaleString()
            }).then(() => alert("Order Placed! Check WhatsApp."));
        }

        // INIT DATA
        function loadData() {
            const user = localStorage.getItem('userPhone');
            if(user) {
                document.getElementById('welcomeMsg').innerText = "Logged in: " + user;
                if(user === MY_PHONE) {
                    document.getElementById('adminBadge').style.display = "inline";
                    document.getElementById('addBtn').style.display = "block";
                    document.getElementById('adminTab').style.display = "block";
                    loadOrders();
                }
            }

            db.collection("products").orderBy("time", "desc").onSnapshot(ss => {
                let html = "";
                ss.forEach(doc => {
                    let p = doc.data();
                    html += `<div class="card">
                        <img src="${p.img || 'https://via.placeholder.com/80'}">
                        <p style="font-size:12px; margin-top:5px;">${p.name}</p>
                        <div class="price">‚Çπ${p.price}</div>
                        <button class="btn" style="padding:5px; font-size:10px;" onclick="placeOrder('${p.name}', ${p.price})">ORDER NOW</button>
                    </div>`;
                });
                document.getElementById('productGrid').innerHTML = html || "<p style='padding:20px;'>No products yet.</p>";
            });
        }

        function loadOrders() {
            db.collection("orders").orderBy("date", "desc").get().then(qs => {
                let html = "";
                qs.forEach(doc => {
                    let o = doc.data();
                    html += `<div class="order-card">
                        <b>üë§ ${o.user}</b><br>
                        üì¶ ${o.item} - ‚Çπ${o.price}<br>
                        <small>üìÖ ${o.date}</small>
                    </div>`;
                });
                document.getElementById('orderList').innerHTML = html;
            });
        }

        function showModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        window.onload = loadData;
    </script>
</body>
</html>